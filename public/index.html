<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Socket.io</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script
      src="https://code.jquery.com/jquery-3.6.4.min.js"
      integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <h1 id="username"></h1>
    <script src="/socket.io/socket.io.js"></script>

    <script>
      let myAddress = "https://my-test-multiuser-webapp.glitch.me/";
      let socket = io(myAddress, {
        headers: {
          "user-agent": "Safari",
        },
      });

      socket.on("connect", function () {
        console.log("connected to server");

        socket.on("userId", () => {
          console.log(`${socket.id}`);
          let myUserId = socket.id;
          let myUsername = document.getElementById("username");
          myUsername.innerHTML = "Hello, " + myUserId;
        });

        socket.emit("adduser", () => {
          let user = `${socket.id}`;
        });

        //////////////////////
        $(document).on("mousemove", function (event) {
          console.log("event triggered");
          socket.emit("mouseActivity", { x: event.pageX, y: event.pageY });
        });

        socket.on("allMouseActivity", function (data) {
          console.log("all mouse activity");

          if ($('.pointer[session_id="' + data.session_id + '"]').length <= 0) {
            console.log("pointer session id");
            $("body").append(
              '<div class="pointer" session_id="' + data.session_id + '"></div>'
            );
          }

          var $pointer = $('.pointer[session_id="' + data.session_id + '"]');
          $pointer.css("left", data.coords.x);
          $pointer.css("top", data.coords.y);
        });

        //////////////////

        socket.on("disconnect", function () {
          console.log("disconnected from server");
        });
      });
    </script>

    <style>
      .pointer {
        position: absolute;
        background: red;
        width: 20px;
        height: 20px;
        border-radius: 10px;
        z-index: 3;
      }
    </style>
  </body>
</html>
